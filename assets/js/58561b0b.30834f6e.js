"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[3942],{743:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"externals","title":"External data sources","description":"Overview","source":"@site/docs/externals.md","sourceDirName":".","slug":"/externals","permalink":"/docs/externals","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Services and Resources","permalink":"/docs/resources"},"next":{"title":"Client connections","permalink":"/docs/client"}}');var i=r(4848),t=r(8453);const a={},c="External data sources",o={},l=[{value:"Overview",id:"overview",level:2},{value:"External Skip services",id:"external-skip-services",level:2},{value:"Non-Skip services",id:"non-skip-services",level:2},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Kafka",id:"kafka",level:3},{value:"Polling",id:"polling",level:3},{value:"Custom external resources/services",id:"custom-external-resourcesservices",level:3}];function d(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"external-data-sources",children:"External data sources"})}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(s.p,{children:"Skip is designed to carefully track computation and data dependencies, so that your service's outputs can be efficiently updated if (and only if!) any inputs they depend on change.\nHowever, when those inputs come from external systems or services it is crucial to ensure that your reactive service still produces up-to-date results."}),"\n",(0,i.jsx)(s.p,{children:"Skip provides mechanisms to do so easily, whether those external systems are other reactive Skip services or non-reactive systems like databases or external APIs."}),"\n",(0,i.jsxs)(s.p,{children:["The core of these mechanisms is the ",(0,i.jsxs)(s.a,{href:"api/core/interfaces/ExternalService",children:[(0,i.jsx)(s.code,{children:"ExternalService"})," type"]}),", which provides a generic interface which can be implemented to wrap arbitrary external systems for use in your Skip service.\nEach Skip reactive service can specify any number of ",(0,i.jsx)(s.code,{children:"ExternalService"}),"s, which can then be brought into the reactive computation graph as an ",(0,i.jsx)(s.code,{children:"EagerCollection"})," with ",(0,i.jsx)(s.a,{href:"api/core/interfaces/Context#useexternalresource",children:(0,i.jsx)(s.code,{children:"Context#useExternalResource"})}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["Skip provides several ",(0,i.jsx)(s.code,{children:"ExternalService"})," implementations:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"api/helpers/classes/SkipExternalService",children:(0,i.jsx)(s.code,{children:"SkipExternalService"})}),", which is used to connect reactive Skip services together."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"api/adapters/postgres/classes/PostgresExternalService",children:(0,i.jsx)(s.code,{children:"PostgresExternalService"})}),", which allows to subscribe to reactive updates from a PostgreSQL database."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"api/adapters/kafka/classes/KafkaExternalService",children:(0,i.jsx)(s.code,{children:"KafkaExternalService"})}),", which allows to connect to and consume messages from a Kafka cluster."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.a,{href:"api/helpers/classes/PolledExternalService",children:(0,i.jsx)(s.code,{children:"PolledExternalService"})}),", which polls non-reactive HTTP endpoints with configurable parameter encoding, refresh interval, and the like."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["If your use case falls outside of these defaults, you can define your own custom external service by providing another ",(0,i.jsx)(s.code,{children:"ExternalService"})," implementation with the required behavior."]}),"\n",(0,i.jsx)(s.h2,{id:"external-skip-services",children:"External Skip services"}),"\n",(0,i.jsx)(s.p,{children:"Skip reactive services are designed to interoperate simply and easily: services push their changes reactively from the bottom up, eagerly propagating updates through a distributed system."}),"\n",(0,i.jsxs)(s.p,{children:["To receive data from another Skip service, specify it in the ",(0,i.jsx)(s.code,{children:"externalServices"})," field of your ",(0,i.jsx)(s.code,{children:"SkipService"}),", for example as follows:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'const service = {\n  initialData: ...,\n  resources: ...,\n  createGraph: ...,\n  externalServices: {\n    myOtherService: SkipExternalService.direct({\n      host: "my.other.service.net",\n      streaming_port: 8080,\n      control_port: 8081,\n    }),\n  },\n};\n\nawait runService(service);\n'})}),"\n",(0,i.jsxs)(s.p,{children:["This instantiates a new service, with a dependency on a service named ",(0,i.jsx)(s.code,{children:"myOtherService"})," running at the specified ports of ",(0,i.jsx)(s.code,{children:"my.other.service.net"}),".\nThat dependency can then be referenced anywhere with access to the Skip context (e.g. in ",(0,i.jsx)(s.code,{children:"createGraph"}),", mapper functions, or resource ",(0,i.jsx)(s.code,{children:"instantiate"})," functions) as follows:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'// Pull in data from external resource:\nconst externalData : EagerCollection<K, V> = context.useExternalResource({\n  service: "myOtherService", // References this service\'s `externalServices` field\n  identifier: "my_resource", // References the other service\'s `resources` field\n  params: {foo: bar, ...}  // Passed to other service\'s Resource constructor\n});\n\n// Use the same as any other reactive eager collection:\nexternalData.map(...);\nexternalData.getArray(...);\n'})}),"\n",(0,i.jsx)(s.p,{children:'This simple setup underlies one of the main strengths of the Skip framework: by receiving data from dependencies, computing any local changes, and pushing updates to dependents, multiple Skip services combine to implement an end-to-end reactive system.\nEncapsulating external reactive dependencies as eager collections, that complex system is defined with simple declarative logic over the "current" state without explicit management of updates/changes.'}),"\n",(0,i.jsx)(s.h2,{id:"non-skip-services",children:"Non-Skip services"}),"\n",(0,i.jsx)(s.p,{children:"Of course, unless your application is built from the ground up using the Skip framework, it is likely that your application depends on some non-reactive external system: REST APIs, databases, external HTTP endpoints, and the like."}),"\n",(0,i.jsx)(s.p,{children:"These external services are provided in Skip framework packages for convenience but they can be customized, added to, or reimplemented as needed for a given use case; nothing beyond the public API is used in their implementations."}),"\n",(0,i.jsx)(s.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,i.jsxs)(s.p,{children:["One common use case for Skip is to reactively update and push results in response to updates in a relational database.\nSkip makes this easy for PostgreSQL users, providing an adapter ",(0,i.jsx)(s.code,{children:"PostgresExternalService"})," that can subscribe to updates from a Postgres database and expose them as an eager collection within your Skip reactive logic."]}),"\n",(0,i.jsxs)(s.p,{children:["A complete example is available ",(0,i.jsx)(s.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews/reactive_service",children:"here"}),"; a basic usage is to specify a Skip service with a Postgres external service, i.e."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const service = {\n  initialData: ...,\n  resources: ...,\n  createGraph: ...,\n  externalServices: {\n    postgres: new PostgresExternalService({ host, port,  ... }),\n    ...,\n  },\n}\n"})}),"\n",(0,i.jsxs)(s.p,{children:["and subscribe to a table (e.g. ",(0,i.jsx)(s.code,{children:"create table t (id serial primary key, value text)"}),") as an EagerCollection, which can be mapped over or otherwise used in reactive logic."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'const t: EagerCollection<number, { id: number, value: string }> =\n  context.useExternalResource({\n    service: "postgres",\n    identifier: "t",\n    params: { key: { col: "id", type: "SERIAL" } },\n  });\n'})}),"\n",(0,i.jsxs)(s.p,{children:["PostgreSQL rows are converted into JavaScript objects keyed by column names using the ",(0,i.jsx)(s.a,{href:"https://www.npmjs.com/package/pg-types",children:(0,i.jsx)(s.code,{children:"pg-types"})})," package, which can be customized according to its documentation if further control is needed over the JavaScript representation of Postgres data."]}),"\n",(0,i.jsx)(s.h3,{id:"kafka",children:"Kafka"}),"\n",(0,i.jsx)(s.p,{children:'Many backend systems use distributed event streaming and messaging systems to handle real time data.\nSkip can process Kafka message streams, allowing to reactively compute over incoming events, with Kafka "topics" treated as external resources.'}),"\n",(0,i.jsxs)(s.p,{children:["An example can be seen ",(0,i.jsx)(s.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/chatroom/reactive_service",children:"here"}),"; a basic usage is to specify a Skip service with a Kafka external service, i.e."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const service = {\n  initialData: ...,\n  resources: ...,\n  createGraph: ...,\n  externalServices: {\n    kafka: new KafkaExternalService({ clientId, brokers, ... }),\n    ...,\n  },\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:"and consume messages into a reactive collection as follows:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'const myKafkaTopic: EagerCollection<string, string> =\n  context.useExternalResource({\n    service: "kafka",\n    identifier: "my-kafka-topic",\n    params: {},\n  });\n'})}),"\n",(0,i.jsxs)(s.p,{children:["By default, Kafka messages are imported into the Skip runtime as their string key and value, but a ",(0,i.jsx)(s.code,{children:"KafkaExternalService"})," can be parameterized by a ",(0,i.jsx)(s.code,{children:"messageProcessor"})," which allows to customize the interpretation of Kafka ",(0,i.jsx)(s.code,{children:"{ key: string; value: string; topic: string }"})," messages as Skip runtime data, for example by performing type conversions or customizing key structure."]}),"\n",(0,i.jsx)(s.h3,{id:"polling",children:"Polling"}),"\n",(0,i.jsx)(s.p,{children:"Many existing systems operate on a pull-based request/response paradigm, so some work is required to adapt them to Skip's eager push-based paradigm."}),"\n",(0,i.jsxs)(s.p,{children:["The simplest option is ",(0,i.jsx)(s.em,{children:"polling"}),", sending periodic requests to pull data from external sources and feed it into the reactive system.\nTo specify a polled external dependency, specify it in your service definition, e.g. as follows"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'const service = {\n  initialData: ...\n  resources: ...\n  createGraph: ...\n  externalServices: {\n    myExternalService: new PolledExternalService({\n      my_resource: {\n        // HTTP endpoint\n        url: "https://api.example.com/my_resource",\n        // Polling interval, in milliseconds\n        interval: 5000,\n        // data processing into `Entry<K, V>[]` key/values structure\n        conv: (data: Json) => Array.from(data, (v, k) => [k, [v]])\n      }\n    }),\n  },\n};\nawait runService(service);\n'})}),"\n",(0,i.jsx)(s.p,{children:"Although the underlying data source is non-reactive, this external service can be used identically to reactive external Skip services as in the previous section, e.g."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:'// Pull in data from external resource:\nconst externalData : EagerCollection<K, V> = context.useExternalResource({\n  service: "myExternalService",\n  identifier: "my_resource",\n  params: {foo: bar, ...}\n});\n\n// Use the same as any other reactive eager collection:\nexternalData.map(...);\nexternalData.getArray(...);\n'})}),"\n",(0,i.jsxs)(s.p,{children:['When the external resource is "used" in this fashion, Skip queries the HTTP endpoint with the given query ',(0,i.jsx)(s.code,{children:"params"})," periodically, updating ",(0,i.jsx)(s.code,{children:"externalData"})," with the results and allowing it to be used as if it were a reactive resource.\nThe frequency of those requests is an important consideration, depending on the latency requirements of the application as well as the load capacity of the external system."]}),"\n",(0,i.jsx)(s.h3,{id:"custom-external-resourcesservices",children:"Custom external resources/services"}),"\n",(0,i.jsxs)(s.p,{children:["If more control is required or your external system does not fit this form, then the ",(0,i.jsx)(s.code,{children:"ExternalService"})," and ",(0,i.jsx)(s.code,{children:"ExternalResource"})," interfaces both support extensions to define arbitrary logic for ",(0,i.jsx)(s.code,{children:"subscribe"}),"/",(0,i.jsx)(s.code,{children:"unsubscribe"}),"-ing from services and ",(0,i.jsx)(s.code,{children:"open"}),"/",(0,i.jsx)(s.code,{children:"close"}),"-ing resource."]}),"\n",(0,i.jsxs)(s.p,{children:["For example, your service can keep track of open resources and combine requests to the external service if it supports batched requests, reducing request load and potentially allowing more optimized execution in the non-reactive system.\nSimilarly, an external relational database may support some limited form of reactivity/listening, such as PostgreSQL's ",(0,i.jsx)(s.code,{children:"pg_notify"}),"; in that case, a custom Skip ",(0,i.jsx)(s.code,{children:"ExternalService"})," can interpret those updates into a form suitable for use within the Skip framework."]})]})}function p(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,s,r)=>{r.d(s,{R:()=>a,x:()=>c});var n=r(6540);const i={},t=n.createContext(i);function a(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);