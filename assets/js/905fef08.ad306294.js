"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[584],{9485:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"deploying","title":"Deploying a Skip service","description":"The process of setting up and deploying a Skip service is mostly similar to that of other backend systems (databases, caches, etc.) but there are some important nuances to be aware of.","source":"@site/docs/deploying.md","sourceDirName":".","slug":"/deploying","permalink":"/docs/deploying","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Client connections","permalink":"/docs/client"},"next":{"title":"Glossary","permalink":"/docs/glossary"}}');var s=n(4848),t=n(8453);const o={},a="Deploying a Skip service",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Running your service",id:"running-your-service",level:2},{value:"Data streaming",id:"data-streaming",level:2},{value:"Control operations and reads/writes",id:"control-operations-and-readswrites",level:2},{value:"Horizontal scaling",id:"horizontal-scaling",level:2}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"deploying-a-skip-service",children:"Deploying a Skip service"})}),"\n",(0,s.jsx)(r.p,{children:"The process of setting up and deploying a Skip service is mostly similar to that of other backend systems (databases, caches, etc.) but there are some important nuances to be aware of."}),"\n",(0,s.jsxs)(r.p,{children:["This page walks through those details, or you can refer to ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples",children:"example setups"})," for representative and complete practical configurations based on standard tooling and components such as Docker, HAProxy, Flask, Express, React, PostgreSQL, and Kafka."]}),"\n",(0,s.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(r.p,{children:"Skip reactive services define an HTTP interface for reading, writing, and subscribing to data.\nIn production use cases for web applications, this should be deployed behind a gateway or reverse proxy such as Kong, Nginx, HAProxy, or Traefik which is responsible for traffic encryption, load balancing, rate limiting, HTTP tunneling, and dispatching requests to backend services.\nThroughout this page we will show HAProxy configuration in examples, but it should be directly applicable to other proxies."}),"\n",(0,s.jsx)(r.p,{children:"Skip is agnostic to your choice of reverse proxy, but it is important that it is configured with HTTP/2 for request/response multiplexing, to avoid browser limitations on concurrent server-sent event connections, and to ensure that TLS is used."}),"\n",(0,s.jsx)(r.h2,{id:"running-your-service",children:"Running your service"}),"\n",(0,s.jsxs)(r.p,{children:["You can build and run your reactive service using Docker Compose and the following ",(0,s.jsx)(r.code,{children:"Dockerfile"})," to expose the necessary ports and initialize the service."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'FROM node:lts-alpine3.19\nWORKDIR /app\nCOPY package.json package.json\nRUN npm install\nCOPY . .\nRUN npm run build\nEXPOSE 8080 8081\nCMD ["npm", "start"]\n'})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"npm start"})," command will, by default, run your service by executing ",(0,s.jsx)(r.code,{children:"./server.js"}),".\nWithin that file, you should perform any necessary setup and then spin up the service by calling ",(0,s.jsx)(r.code,{children:"runService"}),"; see ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/chatroom/reactive_service/server.js",children:"here"})," for an example."]}),"\n",(0,s.jsx)(r.h2,{id:"data-streaming",children:"Data streaming"}),"\n",(0,s.jsxs)(r.p,{children:["As described in the documentation for ",(0,s.jsx)(r.a,{href:"/docs/resources#resource-http-api",children:"resources and services"}),", the Skip reactive service HTTP interface exposes control operations on one port and data streaming on another; the default streaming port is ",(0,s.jsx)(r.code,{children:"8080"})," and the default control port is ",(0,s.jsx)(r.code,{children:"8081"}),".\n",(0,s.jsx)(r.strong,{children:"Important"}),": Similar to how your database connection should not be exposed to the outside world, your application should expose ",(0,s.jsx)(r.em,{children:"only"})," the streaming port to the outside world, the control port should be hidden."]}),"\n",(0,s.jsx)(r.p,{children:"Using HAProxy we can restrict and direct traffic as follows:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"frontend www\n\t# ...\n\tacl url_streams path_beg -i /streams/\n\tuse_backend skip if url_streams\n\t# ...\n\nbackend skip\n\tmode http\n\t# rewrite public-facing url /streams/... to /v1/streams/... for the Skip server\n\thttp-request set-path /v1%[path]\n\tserver stream reactive_service:8080\n"})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"acl"})," and ",(0,s.jsx)(r.code,{children:"use_backend"})," lines in the frontend configuration forward any traffic at a path beginning with ",(0,s.jsx)(r.code,{children:"streams"})," to the ",(0,s.jsx)(r.code,{children:"skip"})," backend.\nThen, that backend rewrites those public-facing urls to the form expected by the reactive service (in this case, just by prepending ",(0,s.jsx)(r.code,{children:"/v1"}),") and specifies the reactive service's address: ",(0,s.jsx)(r.code,{children:"reactive_service:8080"})," here for a service defined as ",(0,s.jsx)(r.code,{children:"reactive_service"}),' using Docker Compose and using the default port.\nThis is a simple "hello world" configuration for a single reactive service; in practice, more involved URL rewriting schemes and ACLs can be employed to orchestrate traffic between multiple public HTTPS endpoints and/or backend reactive services.']}),"\n",(0,s.jsx)(r.h2,{id:"control-operations-and-readswrites",children:"Control operations and reads/writes"}),"\n",(0,s.jsx)(r.p,{children:"The control port of your Skip reactive service should in general only be exposed to other backend services within your secure network, since it allows access to stream creation/deletion and data read/write operations."}),"\n",(0,s.jsxs)(r.p,{children:["This also allows a Skip reactive service to be integrated into your existing web backend(s) -- regardless of their choice of programming language or web framework.\nFor example, see ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews/web_service/app.py",children:"here"})," for an example Python web app using Flask and backed by a reactive service which it communicates to directly over HTTP using the ",(0,s.jsx)(r.code,{children:"requests"})," library, and ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/skipruntime-ts/examples",children:"here"})," (at ",(0,s.jsx)(r.code,{children:"*-server.ts"}),") for a variety of examples in JavaScript using Express.\nFor JavaScript backends, we also provide a programmatic interface ",(0,s.jsx)(r.a,{href:"api/helpers/classes/SkipServiceBroker",children:(0,s.jsx)(r.code,{children:"SkipServiceBroker"})})," which simplifies the integration and obviates the need to construct and manipulate HTTP requests directly."]}),"\n",(0,s.jsx)(r.h2,{id:"horizontal-scaling",children:"Horizontal scaling"}),"\n",(0,s.jsx)(r.p,{children:"For Skip services with sustained or bursty high-throughput requirements, Skip reactive services can scale horizontally to serve many clients without overloading a single machine or incurring heavy resource costs."}),"\n",(0,s.jsxs)(r.p,{children:["The most common bottleneck for reactive systems is ",(0,s.jsx)(r.em,{children:"memory"}),", due to the heavy use of caching and materialization of intermediate results.\nIn a Skip service, much of this memory pressure comes from instantiating large numbers of resources to stream customized/personalized data to many clients.\nTo handle that scenario, you can run your Skip service in a ",(0,s.jsx)(r.em,{children:"leader-follower"})," topology, running:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["one ",(0,s.jsx)(r.em,{children:"leader"})," instance to maintain the shared computation graph and/or pull in data from external dependencies like databases or polled APIs, and"]}),"\n",(0,s.jsxs)(r.li,{children:["one or more ",(0,s.jsx)(r.em,{children:"followers"})," which synchronize that shared data from the leader, among which resource instances are distributed in a round-robin fashion."]}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:["Utilities are available to run a Skip service in ",(0,s.jsx)(r.a,{href:"api/helpers/functions/asLeader",children:"leader"})," or ",(0,s.jsx)(r.a,{href:"api/helpers/functions/asFollower",children:"follower"})," mode, making it easy to scale out from a single-machine deployment to a distributed one."]}),"\n",(0,s.jsxs)(r.p,{children:["An example of such a deployment can be seen in ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews",children:"this example"}),"; ",(0,s.jsx)(r.code,{children:"./compose.distributed.yml"})," and ",(0,s.jsx)(r.code,{children:"./reverse-proxy/haproxy.distributed.cfg"})," show a configuration with equivalent client-visible behavior to ",(0,s.jsx)(r.code,{children:"compose.yml"})," and ",(0,s.jsx)(r.code,{children:"reverse-proxy/haproxy.cfg"})," but running with one leader and three followers instead of just one reactive service."]}),"\n",(0,s.jsxs)(r.p,{children:["This ",(0,s.jsx)(r.em,{children:"leader-follower"})," configuration is just one simple example of a distributed reactive system; more complex custom topologies can be set up for different workloads or application designs, using ",(0,s.jsx)(r.a,{href:"api/helpers/classes/SkipExternalService",children:(0,s.jsx)(r.code,{children:"SkipExternalService"})})," to specify inter-dependencies among reactive services as needed."]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var i=n(6540);const s={},t=i.createContext(s);function o(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);