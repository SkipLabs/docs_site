"use strict";(self.webpackChunkwww=self.webpackChunkwww||[]).push([[584],{619:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"deploying","title":"Deploying a Skip service","description":"The process of setting up and deploying a Skip service is mostly similar to that of other backend systems (databases, caches, etc.) but there are some important nuances to be aware of.","source":"@site/docs/deploying.md","sourceDirName":".","slug":"/deploying","permalink":"/docs/deploying","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Skip fundamentals","permalink":"/docs/fundamentals"},"next":{"title":"Debugging","permalink":"/docs/debugging"}}');var s=n(4848),t=n(8453);const a={},o="Deploying a Skip service",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Running your service",id:"running-your-service",level:3},{value:"Data Streaming",id:"data-streaming",level:3},{value:"Control operations and reads/writes",id:"control-operations-and-readswrites",level:3}];function l(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"deploying-a-skip-service",children:"Deploying a Skip service"})}),"\n",(0,s.jsx)(r.p,{children:"The process of setting up and deploying a Skip service is mostly similar to that of other backend systems (databases, caches, etc.) but there are some important nuances to be aware of."}),"\n",(0,s.jsxs)(r.p,{children:["This page walks through those details, or you can refer to an example's ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews",children:"setup"})," for a representative and complete practical configuration based on standard tooling including Docker, HAProxy, Flask, and React."]}),"\n",(0,s.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(r.p,{children:"Skip reactive services define an HTTP interface for reading, writing, and subscribing to data.\nIn production use cases for web applications, this should be deployed behind a reverse proxy such as Nginx, HAProxy, or Traefik which is responsible for traffic encryption, load balancing, HTTP tunneling, and dispatching requests to backend services.\nThroughout this page we will show HAProxy configuration in examples, but it should be directly applicable to other proxies."}),"\n",(0,s.jsx)(r.p,{children:"Skip is agnostic to your choice of reverse proxy, but it is important that it is configured with HTTP/2 for request/response multiplexing, to avoid browser limitations on concurrent server-sent event connections, and to ensure that TLS is used."}),"\n",(0,s.jsx)(r.h3,{id:"running-your-service",children:"Running your service"}),"\n",(0,s.jsxs)(r.p,{children:["You can build and run your reactive service using Docker Compose and the following ",(0,s.jsx)(r.code,{children:"Dockerfile"})," to expose the necessary ports and initialize the service."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'FROM node:lts-alpine3.19\nWORKDIR /app\nCOPY package.json package.json\nRUN npm install\nCOPY . .\nRUN npm run build\nEXPOSE 8080 8081\nCMD ["npm", "start"]\n'})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"npm start"})," command will, by default, run your service by executing ",(0,s.jsx)(r.code,{children:"./server.js"}),".\nWithin that file, you should perform any necessary setup and then spin up the service by calling ",(0,s.jsx)(r.code,{children:"runService"}),"; see ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews/reactive_service/server.js",children:"here"})," for an example."]}),"\n",(0,s.jsx)(r.h3,{id:"data-streaming",children:"Data Streaming"}),"\n",(0,s.jsxs)(r.p,{children:["As described in the documentation for ",(0,s.jsx)(r.a,{href:"/docs/resources#resource-http-api",children:"resources and services"}),", the Skip reactive service HTTP interface exposes control operations on one port and data streaming on another; the default streaming port is ",(0,s.jsx)(r.code,{children:"8080"})," and the default control port is ",(0,s.jsx)(r.code,{children:"8081"}),".\nYour application should expose ",(0,s.jsx)(r.em,{children:"only"})," the streaming port to the outside world; using HAProxy we can restrict and direct traffic as follows:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"frontend www\n\t# ...\n\tacl url_streams path_beg -i /streams/\n\tuse_backend skip if url_streams\n\t# ...\n\nbackend skip\n\tmode http\n\t# rewrite public-facing url /streams/... to /v1/streams/... for the Skip server\n\thttp-request set-path /v1%[path]\n\tserver stream reactive_service:8080\n"})}),"\n",(0,s.jsxs)(r.p,{children:["The ",(0,s.jsx)(r.code,{children:"acl"})," and ",(0,s.jsx)(r.code,{children:"use_backend"})," lines in the frontend configuration forward any traffic at a path beginning with ",(0,s.jsx)(r.code,{children:"streams"})," to the ",(0,s.jsx)(r.code,{children:"skip"})," backend.\nThen, that backend rewrites those public-facing urls to the form expected by the reactive service (in this case, just by prepending ",(0,s.jsx)(r.code,{children:"/v1"}),") and specifies the reactive service's address: ",(0,s.jsx)(r.code,{children:"reactive_service:8080"})," here for a service defined as ",(0,s.jsx)(r.code,{children:"reactive_service"}),' using Docker Compose and using the default port.\nThis is a simple "hello world" configuration for a single reactive service; in practice, more involved URL rewriting schemes and ACLs can be employed to orchestrate traffic between multiple public HTTPS endpoints and/or backend reactive services.']}),"\n",(0,s.jsx)(r.h3,{id:"control-operations-and-readswrites",children:"Control operations and reads/writes"}),"\n",(0,s.jsx)(r.p,{children:"The control port of your Skip reactive service should in general only be exposed to other backend services within your secure network, since it allows access to stream creation/deletion and data read/write operations."}),"\n",(0,s.jsxs)(r.p,{children:["This also allows a Skip reactive service to be integrated into your existing web backend(s) -- regardless of their choice of programming language or web framework.\nFor example, see ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/examples/hackernews/web_service/app.py",children:"here"})," for an example Python web app using Flask and backed by a reactive service which it communicates to directly over HTTP using the ",(0,s.jsx)(r.code,{children:"requests"})," library, and ",(0,s.jsx)(r.a,{href:"https://github.com/SkipLabs/skip/tree/main/skipruntime-ts",children:"here"})," (at ",(0,s.jsx)(r.code,{children:"*-server.ts"}),") for a variety of examples in JavaScript using Express.\nFor JavaScript backends, we also provide a programmatic interface ",(0,s.jsx)(r.a,{href:"api/helpers/classes/SkipServiceBroker",children:(0,s.jsx)(r.code,{children:"SkipServiceBroker"})})," which simplifies the integration and obviates the need to construct and manipulate HTTP requests directly."]})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var i=n(6540);const s={},t=i.createContext(s);function a(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);